<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WaterPaths-doc: WaterPaths</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WaterPaths-doc
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">WaterPaths </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A utility planning and management tool based off the NC Triangle model.</p>
<h2>What is included in this repository</h2>
<ul>
<li>Source code (<code>/src</code>).</li>
<li>NC Triangle water planning and management problem (<code>src/Problem/PaperTestProblem.cpp</code>).</li>
<li>NC Triangle data (<code>/TestFiles</code>).</li>
<li>Sample input time series (<code>/TestFiles/inflows</code>, <code>evaporation</code>, <code>demand</code>) with 64 realizations each.</li>
</ul>
<h2>Compile and Setup WaterPaths</h2>
<p>To compile WaterPaths, run the following in your command line interface: </p><div class="fragment"><div class="line">make gcc</div></div><!-- fragment --><p>In your WaterPaths directory, make three new folders by typing in the command </p><div class="fragment"><div class="line">mkdir output error rof_tables</div></div><!-- fragment --><p>This will create three folders:</p><ul>
<li><code>output</code> will store the output files of all WaterPaths simulations, includeing your objectives and utility-specific timeseries files.</li>
<li><code>error</code> will store any error messages that may be generated.</li>
<li><code>rof_tables</code> will store your ROF tables should you choose to generate them.</li>
</ul>
<p>Note that WaterPaths requires a minimum of C++ 14.</p>
<h2>Running WaterPaths</h2>
<p>To print a list of flags to for running WaterPaths, use </p><div class="fragment"><div class="line">./waterpaths -?</div></div><!-- fragment --><h3>Running WaterPaths in simulation mode</h3>
<p>For running a reduced version of the Sedento Valley test case model in full simulation mode, run: </p><div class="fragment"><div class="line">./waterpaths -T 4 -t 2344 -r 64 -d /your/current/path/ -s sample_solutions.csv -m 0 </div></div><!-- fragment --><p> The argument of flag -T is the number of threads to be created using OpenMP. If -T flag is not used, the 64 realizations will be distributed across all physical and virtual cores.</p>
<p>There are three options for decreasing runtime for testing purposes that can be used individually or together:</p><ul>
<li>Decreasing the number of realizations (-r flag)</li>
<li>Decreasing the simulation time (-t flag) to no less than 53 (weeks)</li>
<li>Generating pre-computed risk-of-failure (ROF) tables to be used during runs. Keep in mind that if using a different set of inflow, evaporation, of RDM files will warrant new tables. To generate tables, run <div class="fragment"><div class="line">./triangleSimulation -T 4 -t 2344 -r 64 -d /your/current/path/ -s sample_solutions.csv -m 0 -C 1</div></div><!-- fragment --> To run a function evaluation using the tables, set value of -C flag to -1.</li>
</ul>
<h3>Runnning WaterPaths with Borg MS in optimization mode</h3>
<p>To get a copy of Borg, go to Borg's <a href="http://borgmoea.org/">official website</a> and request access to the source code (free for non-commercial use). You should soon after get an e-mail with a link to its repository, where you can download the source code from.</p>
<p>To run WaterPaths in optimization mode, WaterPaths needs to be re-compiled with Borg and the appropriate flags must be passed when calling it from the command line with a program like mpirun. To do so, follow the following steps:</p><ol type="1">
<li>In order to run WaterPaths with Borg, the library libborgms.a must be provided in the /lib folder. To do so, borgmoea.org/ and request a licence, move Borg files to the folder /borg, compile borg by running <code>make mpi</code> in /borg, and finally move the file libborgms.a to the /lib folder.</li>
<li>After libborgms.a is compiled and place in /lib, compile WaterPaths with <code>make borg</code>.</li>
<li>Copy directories cube:/scratch/bct52/TestFiles and cube:/scratch/bct52/rof_tables_cac/ to your directory of preference, or Define a <code>${DATA_DIR}</code> that includes a <code>rof_tables_cac/</code> directory and the <code>TestFiles/</code> directory.</li>
<li>Run WaterPaths with <div class="fragment"><div class="line">mpiexec --hostfile nodefile -np 3 -x OMP_NUM_THREADS ./waterpaths -T 5 -t 2344 -r ${N_REALIZATIONS} -d ${DATA_DIR} -C -1 -O ${DATA_DIR}rof_tables_cac/ -U TestFiles/rdm_utilities_reeval.csv -P TestFiles/rdm_dmp_reeval.csv -W TestFiles/rdm_water_sources_reeval.csv -b true -n 202 -o 100 -e 1</div></div><!-- fragment --> The WaterPaths call above is optimized for a node with 16 cores and will spawn 3 MPI processes running on 5 threats each. Be sure to change the nodefile (see single_run_borgms.sh) and the value of the -T flag for nodes with different number of cores.</li>
<li>The run should take less than 10 minutes if 16 or more cores are being used. The two output files of this run should now be in <code>${DATA_DIR}/output/</code>. The NC_output_MM_S1_N202.set file should consist on a space-separated matrix with 20-80 rows by 63 columns. The /scratch/bct52/output/NC_runtime_MM_S1_N202.runtime file should have between 90 and 200 lines.</li>
</ol>
<h1>Using the InputFileParser</h1>
<p>To simulate and optimize a custom water resource system, the InputFileParser provides front-end support.</p>
<h2>Structure</h2>
<p>To create your own model in WaterPaths, generate a plain-text file (.wp extension), following the format of the files in the <code>Tests</code> directory and described in detail below.</p>
<h3>Blocks</h3>
<p>WaterPaths looks for <em><b>blocks</b></em> of information, which are delimited by <em>tags</em> and describe information on <em>parameters</em>. A <em><b>block</b></em> follows the following form:</p>
<div class="fragment"><div class="line">[TAG]</div><div class="line">parameter value</div><div class="line">parameter value</div><div class="line">...</div></div><!-- fragment --><p>where a [TAG] is an upper-case keyword (defined below) enclosed in brackets and each <em>parameter</em> with a corresponding <em>value</em>.</p>
<h3>Values</h3>
<p>The rest of this documentation will refer to value types as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Standard integer (e.g. 1)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">Standard double-precision value (e.g. 1.05)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">Standard string   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">csv  </td><td class="markdownTableBodyNone">Path to comma-separated values file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ref  </td><td class="markdownTableBodyNone">Path to .reference file   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">dir  </td><td class="markdownTableBodyNone">Path to a directory   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Utility  </td><td class="markdownTableBodyNone">Name of a declared utility.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Source  </td><td class="markdownTableBodyNone">Name of a declared water source (reservoir, allocated reservoir, reuse)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">type,type  </td><td class="markdownTableBodyNone">Two values of type separated by commas   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">type,type,...  </td><td class="markdownTableBodyNone">One or more values of type separated by commas   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">type type  </td><td class="markdownTableBodyNone">Two values of type separated by spaces   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">type type ...  </td><td class="markdownTableBodyNone">One or more values of type separated by spaces   </td></tr>
</table>
<p>Additionally, the type <code>bond info</code> can be represented as </p><div class="fragment"><div class="line">level int int int int deferred</div></div><!-- fragment --><p> which corresponds to </p><div class="fragment"><div class="line">type cost_of_capital n_payments coupon_rate pay_on_weeks begin_repayment_at_issuance</div></div><!-- fragment --><p> Currently, <code>level</code> is the only bond type available and <code>deferred</code> is the only repayment setting.</p>
<h3>Tags</h3>
<p>The currently implemented input file parser [TAG]s are described below.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Tag  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RUN PARAMETERS  </td><td class="markdownTableBodyNone">Information on the type and size of a WaterPaths simulation.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">DATA TO LOAD  </td><td class="markdownTableBodyNone">Location of price, demand, inflow, and evaporation files.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RESERVOIR  </td><td class="markdownTableBodyNone">Defines an existing or potential reservoir.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">ALLOCATED RESERVOIR  </td><td class="markdownTableBodyNone">Defines an existing or potential reservoir allocated between utilities.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RESERVOIR EXPANSION  </td><td class="markdownTableBodyNone">Defines an infrastructure expansion for a reservoir.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">WATER REUSE  </td><td class="markdownTableBodyNone">Defines a water reuse development project.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UTILITY  </td><td class="markdownTableBodyNone">Defines a basic water utility.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">WATER SOURCES GRAPH  </td><td class="markdownTableBodyNone">Specify the connections between water sources.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WS TO UTILITY MATRIX  </td><td class="markdownTableBodyNone">Set up the water source - utility connectivity matrix.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">UTILITIES GRAPH  </td><td class="markdownTableBodyNone">Specify the connections between utilities.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TABLE STORAGE SHIFT  </td><td class="markdownTableBodyNone">Defines the impact of all infrastructure expansion projects on pre-calculated ROF tables.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">RESTRICTIONS POLICY  </td><td class="markdownTableBodyNone">Defines a short-term ROF water use restrictions policy for a utility.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TRANSFERS POLICY  </td><td class="markdownTableBodyNone">Defines a short-term ROF water transfer policy between mutiple utilities.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">INSURANCE POLICY  </td><td class="markdownTableBodyNone">Defines a short-term ROF insurance policy for a utility.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FIXED FLOW RESERVOIR CONTROL RULE  </td><td class="markdownTableBodyNone">A reservoir operating policy that dictates a fixed release.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">INFLOW-BASED RESERVOIR CONTROL RULE  </td><td class="markdownTableBodyNone">A reservoir operating policy where release is dependent on inflow.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SEASONAL RESERVOIR CONTROL RULE  </td><td class="markdownTableBodyNone">A reservoir operating policy that varies seasonally.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">DECISION VARIABLE BOUNDS  </td><td class="markdownTableBodyNone">Declaration of decision variables and their bounds for optimization runs.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OBJECTIVES EPSILONS  </td><td class="markdownTableBodyNone">Epsilon (resolution) for objective values in optimization runs.   </td></tr>
</table>
<h3>[RUN PARAMETERS]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter  </th><th class="markdownTableHeadLeft">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">n_realizations  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Number of realizations   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">n_weeks  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Number of weeks   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">rdm_utilities  </td><td class="markdownTableBodyLeft">csv  </td><td class="markdownTableBodyNone">Input file that contains sampled deeply-uncertain parameters that effect water utilities. <br />
 Each column represents a different factor, and each row represents a state of the world.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">rdm_water_sources  </td><td class="markdownTableBodyLeft">csv  </td><td class="markdownTableBodyNone">Same as rdm_utilities, but for water sources.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">rdm_dmps  </td><td class="markdownTableBodyLeft">csv  </td><td class="markdownTableBodyNone">Same as rdm_utilities, but for drought management policies.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">rdm_no  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">RDM sample to run (only use is running one SOW)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">n_threads  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Number of threads (should not exceed twice the number of core available)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">rof_tables_dir  </td><td class="markdownTableBodyLeft">dir  </td><td class="markdownTableBodyNone">Directory to export or import risk-of-failure metric table   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">use_rof_tables  </td><td class="markdownTableBodyLeft">"generate"<br />
"import"<br />
"no"  </td><td class="markdownTableBodyNone">Generate ROF table<br />
Import ROF table for speedup<br />
Neither   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">print_time_series  </td><td class="markdownTableBodyLeft">bool  </td><td class="markdownTableBodyNone">If present, print the time series data   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">realizations_to_run  </td><td class="markdownTableBodyLeft">int,int  </td><td class="markdownTableBodyNone">Range of realizations to run.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">solutions_file  </td><td class="markdownTableBodyLeft">ref  </td><td class="markdownTableBodyNone">Location of solutions to run   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">n_bootstrap_samples  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Number of bootstrap samples   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">bootstrap_sample_size  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Size of bootstrap samples   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">solutions_to_run  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Number of solutions to run   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">solutions_to_run_range  </td><td class="markdownTableBodyLeft">int,int  </td><td class="markdownTableBodyNone">Range of solutions to run, (e.g. "3,20" would run solutions: 3, 4, ..., 20)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">seed  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyNone">Seed for random number generation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">optimize  </td><td class="markdownTableBodyLeft">int int  </td><td class="markdownTableBodyNone">If present, optimize with Borg for max evaluations and output frequency, respectively   </td></tr>
</table>
<h3>[DATA TO LOAD]</h3>
<p>To load <em>csv</em> data needed for a WaterPaths simulation, use </p><div class="fragment"><div class="line">filename csv</div></div><!-- fragment --><p> where <code>filename</code> is a unique name used to reference the csv file at <code>csv</code> in the remainder of the input file. <br />
 To load only the first <code>n_realizations</code> lines of the file, use <code>*</code> before the filename: </p><div class="fragment"><div class="line">*filename csv</div></div><!-- fragment --><p> Without <code>*</code>, the entire file will be loaded.</p>
<h3>[RESERVOIR]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter  </th><th class="markdownTableHeadLeft">Value Type  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">name  </td><td class="markdownTableBodyLeft">string  </td><td class="markdownTableBodyLeft">Name of this reservoir (to be referred thereafter)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">capacity  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyLeft">Reservoir capacity.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">treatment_capacity  </td><td class="markdownTableBodyLeft">double  </td><td class="markdownTableBodyLeft">Reservoir treatment capacity.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">streamflow_files  </td><td class="markdownTableBodyLeft">filename filename ...  </td><td class="markdownTableBodyLeft">Loaded files describing the streamflow leaving this reservoir.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">evaporation_file  </td><td class="markdownTableBodyLeft">filename  </td><td class="markdownTableBodyLeft">Loaded file with evaporation realizations of this reservoir.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">storage_area  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyLeft">Reservoir area.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">storage_area_curve  </td><td class="markdownTableBodyLeft">int,int int,int ...  </td><td class="markdownTableBodyLeft">Pair-wise relationship defining reservoir storage to reservoir area.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">bond  </td><td class="markdownTableBodyLeft">bond info  </td><td class="markdownTableBodyLeft">Bond for an infrastructure expansion.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ctime  </td><td class="markdownTableBodyLeft">int int  </td><td class="markdownTableBodyLeft">Construction time range: low-high, respectively, in years.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ptime  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyLeft">Permitting time for infrastructure expansion, in years.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">utilities_with_allocations  </td><td class="markdownTableBodyLeft">int  </td><td class="markdownTableBodyLeft">Permitting time for infrastructure expansion, in years.   </td></tr>
</table>
<h3>[ALLOCATED RESERVOIR]</h3>
<p>Same parameters as [RESERVOIR], in addition to:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Parameter  </th><th class="markdownTableHeadLeft">Value Type  </th><th class="markdownTableHeadLeft">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">utilities_with_allocations  </td><td class="markdownTableBodyLeft">Utility,Utility,...  </td><td class="markdownTableBodyLeft">Comma separated list of utilities with allocations on this reservoir   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyLeft">allocated_fractions  </td><td class="markdownTableBodyLeft">double,double,...  </td><td class="markdownTableBodyLeft">Comma separated list of fractions (&lt; 1) corresponding to each <br />
 utility's allocation, in the order of utilities_with_allocations   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">allocated_treatment_fractions  </td><td class="markdownTableBodyLeft">double,double,..  </td><td class="markdownTableBodyLeft">Comma seperated list of fractions corresponding to each <br />
 utility's treatment allocations.   </td></tr>
</table>
<h3>[RESERVOIR EXPANSION]</h3>
<p>Define a [RESERVOIR] or [ALLOCATED RESERVOIR] with parameters representing values after expansion. <br />
 <code>ctime</code> and <code>ptime</code> represent the expansion duration.<br />
 </p><div class="fragment"><div class="line">parent_reservoir Reservoir</div></div><!-- fragment --><p> is the reservoir the expansion is performed on.</p>
<h3>[WATER REUSE]</h3>
<p>Same parameters as [RESERVOIR]. Must include, </p><div class="fragment"><div class="line">treatment_capacity (double)</div></div><!-- fragment --><h3>[UTILITY]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">name  </td><td class="markdownTableBodyNone">string  </td><td class="markdownTableBodyNone">Name of this utility   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">demands  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">File with demand data   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">number_of_week_demands  </td><td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Number of demand weeks   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">percent_contingency_fund_contribution  </td><td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">Percent of anual volumentric revenue that is contributed to a reserve fund.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">typesMonthlyDemandFraction  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">Types of water uses   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">typesMonthlyWaterPrice  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">Corresponding water price for each category.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">wwtp_discharge_rule  </td><td class="markdownTableBodyNone">filename Source,Source,...  </td><td class="markdownTableBodyNone">Rule dictating wastewater return flow.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">demand_buffer  </td><td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">Demand buffer for this utility   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rof_intra_construction_order  </td><td class="markdownTableBodyNone">Source,Source,...  </td><td class="markdownTableBodyNone">Order of precedence for infrastructure expansion   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">infra_construction_triggers  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">ROF triggers values for infrastructure expansions, in order as above   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">infra_discount_rate  </td><td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">Discount rate for infrastructure expansions.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">water_source_to_wtp  </td><td class="markdownTableBodyNone">Source Source ...  </td><td class="markdownTableBodyNone">Water source to water treatment plant connection.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">utility_owned_wtp_capacities  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Capacities of each water treatment plant connected to the utility.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">demand_infra_construction_order  </td><td class="markdownTableBodyNone">Source,Source,...  </td><td class="markdownTableBodyNone">Order of infrastructure construction, triggered by demand.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">infra_if_built_remove  </td><td class="markdownTableBodyNone">Source Source ...  </td><td class="markdownTableBodyNone">List of mutually exclusive infrastructure options that must be removed if another option is triggered.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">construction_pre_requesites  </td><td class="markdownTableBodyNone">Source Source ...  </td><td class="markdownTableBodyNone">List of infrastructure options that must be triggered prior to this   </td></tr>
</table>
<h3>[WATER SOURCES GRAPH]</h3>
<p>This tag creates the network of a water resources system as a graph, with edges corresponding to connections between reservoirs, allocated reservoirs, and water reuses. <br />
 There are no parameters in this block; instead, each line represents a directed <em>edge</em> in the water source graph. Each entry must be the <code>name</code> of a declared water source.<br />
 If a connection exists between <code>source1</code> and <code>source2</code>, include a line in this block as such: </p><div class="fragment"><div class="line">source1,source2</div></div><!-- fragment --><p> For example, this InputFileParser graph and its visual map are shown. </p><div class="fragment"><div class="line">source1,source2</div><div class="line">source2,source3</div><div class="line">source4,source5</div><div class="line">source5,source3</div></div><!-- fragment --> <div class="image">
<img src="https://user-images.githubusercontent.com/61888627/85165928-8e14e900-b234-11ea-9161-6c9b2e14a01c.png"/>
</div>
<h3>[UTILITIES GRAPH]</h3>
<p>This tag is similar to [WATER SOURCES GRAPH], except for utilites. An <em>edge</em> between water sources represents a potential water exchange between two utilites. The same format as [WATER SOURCES GRAPH] is followed.</p>
<h3>[WS TO UTILITY MATRIX]</h3>
<p>WaterPaths represents the connections between utilities and water sources as </p><div class="fragment"><div class="line">utility source1,source2,...</div></div><!-- fragment --><p> where <code>utility</code> is a utillity name and the subsequent <code>sources</code> are water source names. Here, <code>utility</code> uses <code>source1</code>, <code>source2</code>, and all following sources to reach its demand. Each declared utility must have its own line in this block.</p>
<h3>[TABLE STORAGE SHIFT]</h3>
<p>Here, we define a matrix for respective table shortage shifts for potential reservoir expansions.<br />
 Entries should be in the following form: </p><div class="fragment"><div class="line">Utility Reservoir shift</div></div><!-- fragment --><p> where <code>shift</code> is the integer representing associated reservoir table shift.</p>
<h3>[RESTRICTIONS POLICY]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">apply_to_utilities  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">Which utility (or utilities) this restriction policy is to be applied to   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">stage_multipliers  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Demand reductions (percentage of unrestricted demand) associated with each restriction stage.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">stage_triggers  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Short term ROF restrictions triggers   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">typesMonthlyDemandFraction  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">Types of water uses   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">typesMonthlyWaterPrice  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">Types of water prices   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">priceMultipliers  </td><td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone">Multipliers on water price   </td></tr>
</table>
<h3>[TRANSFERS POLICY]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">apply_to_utilities  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">The utility (or utilities) that are the buyers for this transfer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">source_utility_id  </td><td class="markdownTableBodyNone">Utility  </td><td class="markdownTableBodyNone">Which utility is the source for this transfer policy   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">transfer_water_source_id  </td><td class="markdownTableBodyNone">Source  </td><td class="markdownTableBodyNone">Which source the transfers utilize   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">source_treatment_buffer  </td><td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">Buffer for source treatment   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">pipe_transfer_capacities  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Capacity of inter-connections between utilities.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">buyers_transfer_triggers  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Short term ROF triggers for transfers   </td></tr>
</table>
<h3>[INSURANCE POLICY]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">apply_to_utilities  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">The utility (or utilities) that are the buyers for this transfer   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">insurance_triggers  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Short term ROF triggers for this drought insurance policy   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">insurance_premium  </td><td class="markdownTableBodyNone">double  </td><td class="markdownTableBodyNone">The premium on this insurance policy   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">fixed_payouts  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Amount of fixed payouts from insurance   </td></tr>
</table>
<h3>[FIXED FLOW RESERVOIR CONTROL RULE]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water_source_id  </td><td class="markdownTableBodyNone">Source  </td><td class="markdownTableBodyNone">The source of this fixed flow control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">release  </td><td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Volume of water released.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">aux_water_sources_id  </td><td class="markdownTableBodyNone">Source,Source,...  </td><td class="markdownTableBodyNone">Auxiliary sources for this control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">aux_utilities_id  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">Auxiliary utilities for this control rule   </td></tr>
</table>
<h3>[INFLOW-BASED RESERVOIR CONTROL RULE]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water_source_id  </td><td class="markdownTableBodyNone">Source  </td><td class="markdownTableBodyNone">The source of this inflow-based control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">inflows  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Vector of reservoir inflows that define releases   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">releases  </td><td class="markdownTableBodyNone">double,double,...  </td><td class="markdownTableBodyNone">Vector of released defined by inflows   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">aux_water_sources_id  </td><td class="markdownTableBodyNone">Source,Source,...  </td><td class="markdownTableBodyNone">Auxiliary sources for this control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">aux_utilities_id  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">Auxiliary utilities for this control rule   </td></tr>
</table>
<h3>[SEASONAL RESERVOIR CONTROL RULE]</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value Type  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">water_source_id  </td><td class="markdownTableBodyNone">Source  </td><td class="markdownTableBodyNone">The source of this fixed flow control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">week_thresholds  </td><td class="markdownTableBodyNone">int,int,int,int  </td><td class="markdownTableBodyNone">Weeks that define each season   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">releases  </td><td class="markdownTableBodyNone">double,double,double,double  </td><td class="markdownTableBodyNone">Releases for each season   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">aux_water_sources_id  </td><td class="markdownTableBodyNone">Source,Source,...  </td><td class="markdownTableBodyNone">Auxiliary sources for this control rule   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">aux_utilities_id  </td><td class="markdownTableBodyNone">Utility,Utility,...  </td><td class="markdownTableBodyNone">Auxiliary utilities for this control rule   </td></tr>
</table>
<h3>[DECISON VARIABLE BOUNDS]</h3>
<p>If this WaterPaths simulation is an optimization, this block tells the BorgMOEA which variables to optimize within the WaterPaths framework. Each line should follow this format: </p><div class="fragment"><div class="line">index lowerbound,upperbound</div></div><!-- fragment --><p> The <code>lowerbound</code> and <code>upperbound</code> numeric values indicate the lowest and highest values this decision variable can take. <br />
 The <code>index</code> value is an integer, and each value in <em>0..n-1</em>, where <em>n</em> is the number of decision varaibles, must be taken. <br />
</p>
<p>A decision variable's <code>index</code> describes its relative ordered position within the *.wp* file. To declare a specific decision variable instance in another block, use <code>%%%</code> for optimized <em>values</em> and <code>@</code> preceding an alias for optimized orderings. <br />
</p>
<p>For example, consider a simple optimization case with 4 decision variables.<br />
</p>
<ol type="1">
<li>Declare the decision varibles in a [DECISION VARIABLE BOUNDS] block. <div class="fragment"><div class="line">[DECISION VARIABLE BOUNDS]</div><div class="line">0 0.001,0.75    # utility1 transfer ROF trigger</div><div class="line">1 0.0,1,0       # source1 construction rank</div><div class="line">2 0.0,1.0       # source2 construction rank</div><div class="line">3 0.0,1.0       # source3 construction rank</div></div><!-- fragment --></li>
<li>Declare decision variable <code>0</code> (utility1 transfer ROF trigger) within a [TRANSFERS POLICY] block with a <code>%%%</code> <div class="fragment"><div class="line">[TRANSFERS POLICY]</div><div class="line">apply_to_utilities utility1</div><div class="line">source_utility_id RandomUtility</div><div class="line">...</div><div class="line">buyers_transfer_triggers %%%</div></div><!-- fragment --></li>
<li>Declare decison variables <code>1</code> <code>2</code> and <code>3</code> (construction ranks) within a [UTILITY] block with a series of <code>@</code> <div class="fragment"><div class="line">[UTILITY]</div><div class="line">name RandomUtlity</div><div class="line">...</div><div class="line">rof_infra_construction_order @source1,@source2,@source3</div><div class="line">...</div></div><!-- fragment --></li>
</ol>
<p>This input file configuration will optimize a short-term transfer ROF for <code>utility1</code> and a long-term infrastructure expansion ordering for each <code>source</code>. Ensure that the intended ordering of decision varaibles (as declared within the [DECISION VARIABLES BOUNDS] block) corresponds to the order of appearence in the remainder of the input file. <br />
</p>
<p>For a more advanced optimization problem formulation, refer to <code>Tests/test_input_file_borg.wp</code>.</p>
<h3>[OBJECTIVES EPSILONS]</h3>
<p>This tag declares the epsilon values for the five objectives:</p><ol type="1">
<li>Reliability</li>
<li>Restriction Frequency</li>
<li>Infrastructure NPV</li>
<li>Financial Cost</li>
<li>Worse First Percentile Cost</li>
</ol>
<p>This block has one line, in the form: </p><div class="fragment"><div class="line">ep1,ep2,ep3,ep4,ep5</div></div><!-- fragment --><p> where each epsilon corresponds to the respective numbered objective.<br />
</p>
<p>To use the recommended epsilon values, include this block: </p><div class="fragment"><div class="line">[OBJECTIVES EPSILONS]</div><div class="line">0.001,0.02,10.0,0.025,0.01</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
