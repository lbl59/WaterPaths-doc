<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="md_README" kind="page">
    <compoundname>md_README</compoundname>
    <title>WaterPaths</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>A utility planning and management tool based off the NC Triangle model.</para><para><heading level="2">What is included in this repository</heading>
</para><para><itemizedlist>
<listitem><para>Source code (<computeroutput>/src</computeroutput>).</para></listitem><listitem><para>NC Triangle water planning and management problem (<computeroutput>src/Problem/PaperTestProblem.cpp</computeroutput>).</para></listitem><listitem><para>NC Triangle data (<computeroutput>/TestFiles</computeroutput>).</para></listitem><listitem><para>Sample input time series (<computeroutput>/TestFiles/inflows</computeroutput>, <computeroutput>evaporation</computeroutput>, <computeroutput>demand</computeroutput>) with 64 realizations each.</para></listitem></itemizedlist>
</para><para><heading level="2">Compile and Setup WaterPaths</heading>
</para><para>To compile WaterPaths, run the following in your command line interface: <programlisting><codeline><highlight class="normal">make<sp/>gcc</highlight></codeline>
</programlisting></para><para>In your WaterPaths directory, make three new folders by typing in the command <programlisting><codeline><highlight class="normal">mkdir<sp/>output<sp/>error<sp/>rof_tables</highlight></codeline>
</programlisting></para><para>This will create three folders:<itemizedlist>
<listitem><para><computeroutput>output</computeroutput> will store the output files of all WaterPaths simulations, includeing your objectives and utility-specific timeseries files.</para></listitem><listitem><para><computeroutput>error</computeroutput> will store any error messages that may be generated.</para></listitem><listitem><para><computeroutput>rof_tables</computeroutput> will store your ROF tables should you choose to generate them.</para></listitem></itemizedlist>
</para><para>Note that WaterPaths requires a minimum of C++ 14.</para><para><heading level="2">Running WaterPaths</heading>
</para><para>To print a list of flags to for running WaterPaths, use <programlisting><codeline><highlight class="normal">./waterpaths<sp/>-?</highlight></codeline>
</programlisting></para><para><heading level="3">Running WaterPaths in simulation mode</heading>
</para><para>For running a reduced version of the Sedento Valley test case model in full simulation mode, run: <programlisting><codeline><highlight class="normal">./waterpaths<sp/>-T<sp/>4<sp/>-t<sp/>2344<sp/>-r<sp/>64<sp/>-d<sp/>/your/current/path/<sp/>-s<sp/>sample_solutions.csv<sp/>-m<sp/>0<sp/></highlight></codeline>
</programlisting> The argument of flag -T is the number of threads to be created using OpenMP. If -T flag is not used, the 64 realizations will be distributed across all physical and virtual cores.</para><para>There are three options for decreasing runtime for testing purposes that can be used individually or together:<itemizedlist>
<listitem><para>Decreasing the number of realizations (-r flag)</para></listitem><listitem><para>Decreasing the simulation time (-t flag) to no less than 53 (weeks)</para></listitem><listitem><para>Generating pre-computed risk-of-failure (ROF) tables to be used during runs. Keep in mind that if using a different set of inflow, evaporation, of RDM files will warrant new tables. To generate tables, run <programlisting><codeline><highlight class="normal">./triangleSimulation<sp/>-T<sp/>4<sp/>-t<sp/>2344<sp/>-r<sp/>64<sp/>-d<sp/>/your/current/path/<sp/>-s<sp/>sample_solutions.csv<sp/>-m<sp/>0<sp/>-C<sp/>1</highlight></codeline>
</programlisting> To run a function evaluation using the tables, set value of -C flag to -1.</para></listitem></itemizedlist>
</para><para><heading level="3">Runnning WaterPaths with Borg MS in optimization mode</heading>
</para><para>To get a copy of Borg, go to Borg&apos;s <ulink url="http://borgmoea.org/">official website</ulink> and request access to the source code (free for non-commercial use). You should soon after get an e-mail with a link to its repository, where you can download the source code from.</para><para>To run WaterPaths in optimization mode, WaterPaths needs to be re-compiled with Borg and the appropriate flags must be passed when calling it from the command line with a program like mpirun. To do so, follow the following steps:<orderedlist>
<listitem><para>In order to run WaterPaths with Borg, the library libborgms.a must be provided in the /lib folder. To do so, borgmoea.org/ and request a licence, move Borg files to the folder /borg, compile borg by running <computeroutput>make mpi</computeroutput> in /borg, and finally move the file libborgms.a to the /lib folder.</para></listitem><listitem><para>After libborgms.a is compiled and place in /lib, compile WaterPaths with <computeroutput>make borg</computeroutput>.</para></listitem><listitem><para>Copy directories cube:/scratch/bct52/TestFiles and cube:/scratch/bct52/rof_tables_cac/ to your directory of preference, or Define a <computeroutput>${DATA_DIR}</computeroutput> that includes a <computeroutput>rof_tables_cac/</computeroutput> directory and the <computeroutput>TestFiles/</computeroutput> directory.</para></listitem><listitem><para>Run WaterPaths with <programlisting><codeline><highlight class="normal">mpiexec<sp/>--hostfile<sp/>nodefile<sp/>-np<sp/>3<sp/>-x<sp/>OMP_NUM_THREADS<sp/>./waterpaths<sp/>-T<sp/>5<sp/>-t<sp/>2344<sp/>-r<sp/>${N_REALIZATIONS}<sp/>-d<sp/>${DATA_DIR}<sp/>-C<sp/>-1<sp/>-O<sp/>${DATA_DIR}rof_tables_cac/<sp/>-U<sp/>TestFiles/rdm_utilities_reeval.csv<sp/>-P<sp/>TestFiles/rdm_dmp_reeval.csv<sp/>-W<sp/>TestFiles/rdm_water_sources_reeval.csv<sp/>-b<sp/>true<sp/>-n<sp/>202<sp/>-o<sp/>100<sp/>-e<sp/>1</highlight></codeline>
</programlisting> The WaterPaths call above is optimized for a node with 16 cores and will spawn 3 MPI processes running on 5 threats each. Be sure to change the nodefile (see single_run_borgms.sh) and the value of the -T flag for nodes with different number of cores.</para></listitem><listitem><para>The run should take less than 10 minutes if 16 or more cores are being used. The two output files of this run should now be in <computeroutput>${DATA_DIR}/output/</computeroutput>. The NC_output_MM_S1_N202.set file should consist on a space-separated matrix with 20-80 rows by 63 columns. The /scratch/bct52/output/NC_runtime_MM_S1_N202.runtime file should have between 90 and 200 lines.</para></listitem></orderedlist>
</para><para><heading level="1">Using the InputFileParser</heading>
</para><para>To simulate and optimize a custom water resource system, the InputFileParser provides front-end support.</para><para><heading level="2">Structure</heading>
</para><para>To create your own model in WaterPaths, generate a plain-text file (.wp extension), following the format of the files in the <computeroutput>Tests</computeroutput> directory and described in detail below.</para><para><heading level="3">Blocks</heading>
</para><para>WaterPaths looks for <emphasis><bold>blocks</bold></emphasis> of information, which are delimited by <emphasis>tags</emphasis> and describe information on <emphasis>parameters</emphasis>. A <emphasis><bold>block</bold></emphasis> follows the following form:</para><para><programlisting><codeline><highlight class="normal">[TAG]</highlight></codeline>
<codeline><highlight class="normal">parameter<sp/>value</highlight></codeline>
<codeline><highlight class="normal">parameter<sp/>value</highlight></codeline>
<codeline><highlight class="normal">...</highlight></codeline>
</programlisting></para><para>where a [TAG] is an upper-case keyword (defined below) enclosed in brackets and each <emphasis>parameter</emphasis> with a corresponding <emphasis>value</emphasis>.</para><para><heading level="3">Values</heading>
</para><para>The rest of this documentation will refer to value types as follows:</para><para><table rows="13" cols="2"><row>
<entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>int  </para></entry><entry thead="no"><para>Standard integer (e.g. 1)   </para></entry></row>
<row>
<entry thead="no"><para>double  </para></entry><entry thead="no"><para>Standard double-precision value (e.g. 1.05)   </para></entry></row>
<row>
<entry thead="no"><para>string  </para></entry><entry thead="no"><para>Standard string   </para></entry></row>
<row>
<entry thead="no"><para>csv  </para></entry><entry thead="no"><para>Path to comma-separated values file   </para></entry></row>
<row>
<entry thead="no"><para>ref  </para></entry><entry thead="no"><para>Path to .reference file   </para></entry></row>
<row>
<entry thead="no"><para>dir  </para></entry><entry thead="no"><para>Path to a directory   </para></entry></row>
<row>
<entry thead="no"><para>Utility  </para></entry><entry thead="no"><para>Name of a declared utility.   </para></entry></row>
<row>
<entry thead="no"><para>Source  </para></entry><entry thead="no"><para>Name of a declared water source (reservoir, allocated reservoir, reuse)   </para></entry></row>
<row>
<entry thead="no"><para>type,type  </para></entry><entry thead="no"><para>Two values of type separated by commas   </para></entry></row>
<row>
<entry thead="no"><para>type,type,...  </para></entry><entry thead="no"><para>One or more values of type separated by commas   </para></entry></row>
<row>
<entry thead="no"><para>type type  </para></entry><entry thead="no"><para>Two values of type separated by spaces   </para></entry></row>
<row>
<entry thead="no"><para>type type ...  </para></entry><entry thead="no"><para>One or more values of type separated by spaces   </para></entry></row>
</table>
</para><para>Additionally, the type <computeroutput>bond info</computeroutput> can be represented as <programlisting><codeline><highlight class="normal">level<sp/>int<sp/>int<sp/>int<sp/>int<sp/>deferred</highlight></codeline>
</programlisting> which corresponds to <programlisting><codeline><highlight class="normal">type<sp/>cost_of_capital<sp/>n_payments<sp/>coupon_rate<sp/>pay_on_weeks<sp/>begin_repayment_at_issuance</highlight></codeline>
</programlisting> Currently, <computeroutput>level</computeroutput> is the only bond type available and <computeroutput>deferred</computeroutput> is the only repayment setting.</para><para><heading level="3">Tags</heading>
</para><para>The currently implemented input file parser [TAG]s are described below.</para><para><table rows="20" cols="2"><row>
<entry thead="yes"><para>Tag  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>RUN PARAMETERS  </para></entry><entry thead="no"><para>Information on the type and size of a WaterPaths simulation.   </para></entry></row>
<row>
<entry thead="no"><para>DATA TO LOAD  </para></entry><entry thead="no"><para>Location of price, demand, inflow, and evaporation files.   </para></entry></row>
<row>
<entry thead="no"><para>RESERVOIR  </para></entry><entry thead="no"><para>Defines an existing or potential reservoir.   </para></entry></row>
<row>
<entry thead="no"><para>ALLOCATED RESERVOIR  </para></entry><entry thead="no"><para>Defines an existing or potential reservoir allocated between utilities.   </para></entry></row>
<row>
<entry thead="no"><para>RESERVOIR EXPANSION  </para></entry><entry thead="no"><para>Defines an infrastructure expansion for a reservoir.   </para></entry></row>
<row>
<entry thead="no"><para>WATER REUSE  </para></entry><entry thead="no"><para>Defines a water reuse development project.   </para></entry></row>
<row>
<entry thead="no"><para>UTILITY  </para></entry><entry thead="no"><para>Defines a basic water utility.   </para></entry></row>
<row>
<entry thead="no"><para>WATER SOURCES GRAPH  </para></entry><entry thead="no"><para>Specify the connections between water sources.   </para></entry></row>
<row>
<entry thead="no"><para>WS TO UTILITY MATRIX  </para></entry><entry thead="no"><para>Set up the water source - utility connectivity matrix.   </para></entry></row>
<row>
<entry thead="no"><para>UTILITIES GRAPH  </para></entry><entry thead="no"><para>Specify the connections between utilities.   </para></entry></row>
<row>
<entry thead="no"><para>TABLE STORAGE SHIFT  </para></entry><entry thead="no"><para>Defines the impact of all infrastructure expansion projects on pre-calculated ROF tables.   </para></entry></row>
<row>
<entry thead="no"><para>RESTRICTIONS POLICY  </para></entry><entry thead="no"><para>Defines a short-term ROF water use restrictions policy for a utility.   </para></entry></row>
<row>
<entry thead="no"><para>TRANSFERS POLICY  </para></entry><entry thead="no"><para>Defines a short-term ROF water transfer policy between mutiple utilities.   </para></entry></row>
<row>
<entry thead="no"><para>INSURANCE POLICY  </para></entry><entry thead="no"><para>Defines a short-term ROF insurance policy for a utility.   </para></entry></row>
<row>
<entry thead="no"><para>FIXED FLOW RESERVOIR CONTROL RULE  </para></entry><entry thead="no"><para>A reservoir operating policy that dictates a fixed release.   </para></entry></row>
<row>
<entry thead="no"><para>INFLOW-BASED RESERVOIR CONTROL RULE  </para></entry><entry thead="no"><para>A reservoir operating policy where release is dependent on inflow.   </para></entry></row>
<row>
<entry thead="no"><para>SEASONAL RESERVOIR CONTROL RULE  </para></entry><entry thead="no"><para>A reservoir operating policy that varies seasonally.   </para></entry></row>
<row>
<entry thead="no"><para>DECISION VARIABLE BOUNDS  </para></entry><entry thead="no"><para>Declaration of decision variables and their bounds for optimization runs.   </para></entry></row>
<row>
<entry thead="no"><para>OBJECTIVES EPSILONS  </para></entry><entry thead="no"><para>Epsilon (resolution) for objective values in optimization runs.   </para></entry></row>
</table>
</para><para><heading level="3">[RUN PARAMETERS]</heading>
</para><para><table rows="19" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>n_realizations  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of realizations   </para></entry></row>
<row>
<entry thead="no"><para>n_weeks  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of weeks   </para></entry></row>
<row>
<entry thead="no"><para>rdm_utilities  </para></entry><entry thead="no"><para>csv  </para></entry><entry thead="no"><para>Input file that contains sampled deeply-uncertain parameters that effect water utilities. <linebreak/>
 Each column represents a different factor, and each row represents a state of the world.   </para></entry></row>
<row>
<entry thead="no"><para>rdm_water_sources  </para></entry><entry thead="no"><para>csv  </para></entry><entry thead="no"><para>Same as rdm_utilities, but for water sources.   </para></entry></row>
<row>
<entry thead="no"><para>rdm_dmps  </para></entry><entry thead="no"><para>csv  </para></entry><entry thead="no"><para>Same as rdm_utilities, but for drought management policies.   </para></entry></row>
<row>
<entry thead="no"><para>rdm_no  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>RDM sample to run (only use is running one SOW)   </para></entry></row>
<row>
<entry thead="no"><para>n_threads  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of threads (should not exceed twice the number of core available)   </para></entry></row>
<row>
<entry thead="no"><para>rof_tables_dir  </para></entry><entry thead="no"><para>dir  </para></entry><entry thead="no"><para>Directory to export or import risk-of-failure metric table   </para></entry></row>
<row>
<entry thead="no"><para>use_rof_tables  </para></entry><entry thead="no"><para>&quot;generate&quot;<linebreak/>
&quot;import&quot;<linebreak/>
&quot;no&quot;  </para></entry><entry thead="no"><para>Generate ROF table<linebreak/>
Import ROF table for speedup<linebreak/>
Neither   </para></entry></row>
<row>
<entry thead="no"><para>print_time_series  </para></entry><entry thead="no"><para>bool  </para></entry><entry thead="no"><para>If present, print the time series data   </para></entry></row>
<row>
<entry thead="no"><para>realizations_to_run  </para></entry><entry thead="no"><para>int,int  </para></entry><entry thead="no"><para>Range of realizations to run.   </para></entry></row>
<row>
<entry thead="no"><para>solutions_file  </para></entry><entry thead="no"><para>ref  </para></entry><entry thead="no"><para>Location of solutions to run   </para></entry></row>
<row>
<entry thead="no"><para>n_bootstrap_samples  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of bootstrap samples   </para></entry></row>
<row>
<entry thead="no"><para>bootstrap_sample_size  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Size of bootstrap samples   </para></entry></row>
<row>
<entry thead="no"><para>solutions_to_run  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of solutions to run   </para></entry></row>
<row>
<entry thead="no"><para>solutions_to_run_range  </para></entry><entry thead="no"><para>int,int  </para></entry><entry thead="no"><para>Range of solutions to run, (e.g. &quot;3,20&quot; would run solutions: 3, 4, ..., 20)   </para></entry></row>
<row>
<entry thead="no"><para>seed  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Seed for random number generation   </para></entry></row>
<row>
<entry thead="no"><para>optimize  </para></entry><entry thead="no"><para>int int  </para></entry><entry thead="no"><para>If present, optimize with Borg for max evaluations and output frequency, respectively   </para></entry></row>
</table>
</para><para><heading level="3">[DATA TO LOAD]</heading>
</para><para>To load <emphasis>csv</emphasis> data needed for a WaterPaths simulation, use <programlisting><codeline><highlight class="normal">filename<sp/>csv</highlight></codeline>
</programlisting> where <computeroutput>filename</computeroutput> is a unique name used to reference the csv file at <computeroutput>csv</computeroutput> in the remainder of the input file. <linebreak/>
 To load only the first <computeroutput>n_realizations</computeroutput> lines of the file, use <computeroutput>*</computeroutput> before the filename: <programlisting><codeline><highlight class="normal">*filename<sp/>csv</highlight></codeline>
</programlisting> Without <computeroutput>*</computeroutput>, the entire file will be loaded.</para><para><heading level="3">[RESERVOIR]</heading>
</para><para><table rows="12" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>name  </para></entry><entry thead="no"><para>string  </para></entry><entry thead="no"><para>Name of this reservoir (to be referred thereafter)   </para></entry></row>
<row>
<entry thead="no"><para>capacity  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Reservoir capacity.   </para></entry></row>
<row>
<entry thead="no"><para>treatment_capacity  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>Reservoir treatment capacity.   </para></entry></row>
<row>
<entry thead="no"><para>streamflow_files  </para></entry><entry thead="no"><para>filename filename ...  </para></entry><entry thead="no"><para>Loaded files describing the streamflow leaving this reservoir.   </para></entry></row>
<row>
<entry thead="no"><para>evaporation_file  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Loaded file with evaporation realizations of this reservoir.   </para></entry></row>
<row>
<entry thead="no"><para>storage_area  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Reservoir area.   </para></entry></row>
<row>
<entry thead="no"><para>storage_area_curve  </para></entry><entry thead="no"><para>int,int int,int ...  </para></entry><entry thead="no"><para>Pair-wise relationship defining reservoir storage to reservoir area.   </para></entry></row>
<row>
<entry thead="no"><para>bond  </para></entry><entry thead="no"><para>bond info  </para></entry><entry thead="no"><para>Bond for an infrastructure expansion.   </para></entry></row>
<row>
<entry thead="no"><para>ctime  </para></entry><entry thead="no"><para>int int  </para></entry><entry thead="no"><para>Construction time range: low-high, respectively, in years.   </para></entry></row>
<row>
<entry thead="no"><para>ptime  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Permitting time for infrastructure expansion, in years.   </para></entry></row>
<row>
<entry thead="no"><para>utilities_with_allocations  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Permitting time for infrastructure expansion, in years.   </para></entry></row>
</table>
</para><para><heading level="3">[ALLOCATED RESERVOIR]</heading>
</para><para>Same parameters as [RESERVOIR], in addition to:</para><para><table rows="4" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>utilities_with_allocations  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>Comma separated list of utilities with allocations on this reservoir   </para></entry></row>
<row>
<entry thead="no"><para>allocated_fractions  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Comma separated list of fractions (&lt; 1) corresponding to each <linebreak/>
 utility&apos;s allocation, in the order of utilities_with_allocations   </para></entry></row>
<row>
<entry thead="no"><para>allocated_treatment_fractions  </para></entry><entry thead="no"><para>double,double,..  </para></entry><entry thead="no"><para>Comma seperated list of fractions corresponding to each <linebreak/>
 utility&apos;s treatment allocations.   </para></entry></row>
</table>
</para><para><heading level="3">[RESERVOIR EXPANSION]</heading>
</para><para>Define a [RESERVOIR] or [ALLOCATED RESERVOIR] with parameters representing values after expansion. <linebreak/>
 <computeroutput>ctime</computeroutput> and <computeroutput>ptime</computeroutput> represent the expansion duration.<linebreak/>
 <programlisting><codeline><highlight class="normal">parent_reservoir<sp/>Reservoir</highlight></codeline>
</programlisting> is the reservoir the expansion is performed on.</para><para><heading level="3">[WATER REUSE]</heading>
</para><para>Same parameters as [RESERVOIR]. Must include, <programlisting><codeline><highlight class="normal">treatment_capacity<sp/>(double)</highlight></codeline>
</programlisting></para><para><heading level="3">[UTILITY]</heading>
</para><para><table rows="17" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>name  </para></entry><entry thead="no"><para>string  </para></entry><entry thead="no"><para>Name of this utility   </para></entry></row>
<row>
<entry thead="no"><para>demands  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>File with demand data   </para></entry></row>
<row>
<entry thead="no"><para>number_of_week_demands  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Number of demand weeks   </para></entry></row>
<row>
<entry thead="no"><para>percent_contingency_fund_contribution  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>Percent of anual volumentric revenue that is contributed to a reserve fund.   </para></entry></row>
<row>
<entry thead="no"><para>typesMonthlyDemandFraction  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Types of water uses   </para></entry></row>
<row>
<entry thead="no"><para>typesMonthlyWaterPrice  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Corresponding water price for each category.   </para></entry></row>
<row>
<entry thead="no"><para>wwtp_discharge_rule  </para></entry><entry thead="no"><para>filename Source,Source,...  </para></entry><entry thead="no"><para>Rule dictating wastewater return flow.   </para></entry></row>
<row>
<entry thead="no"><para>demand_buffer  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>Demand buffer for this utility   </para></entry></row>
<row>
<entry thead="no"><para>rof_intra_construction_order  </para></entry><entry thead="no"><para>Source,Source,...  </para></entry><entry thead="no"><para>Order of precedence for infrastructure expansion   </para></entry></row>
<row>
<entry thead="no"><para>infra_construction_triggers  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>ROF triggers values for infrastructure expansions, in order as above   </para></entry></row>
<row>
<entry thead="no"><para>infra_discount_rate  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>Discount rate for infrastructure expansions.   </para></entry></row>
<row>
<entry thead="no"><para>water_source_to_wtp  </para></entry><entry thead="no"><para>Source Source ...  </para></entry><entry thead="no"><para>Water source to water treatment plant connection.   </para></entry></row>
<row>
<entry thead="no"><para>utility_owned_wtp_capacities  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Capacities of each water treatment plant connected to the utility.   </para></entry></row>
<row>
<entry thead="no"><para>demand_infra_construction_order  </para></entry><entry thead="no"><para>Source,Source,...  </para></entry><entry thead="no"><para>Order of infrastructure construction, triggered by demand.   </para></entry></row>
<row>
<entry thead="no"><para>infra_if_built_remove  </para></entry><entry thead="no"><para>Source Source ...  </para></entry><entry thead="no"><para>List of mutually exclusive infrastructure options that must be removed if another option is triggered.   </para></entry></row>
<row>
<entry thead="no"><para>construction_pre_requesites  </para></entry><entry thead="no"><para>Source Source ...  </para></entry><entry thead="no"><para>List of infrastructure options that must be triggered prior to this   </para></entry></row>
</table>
</para><para><heading level="3">[WATER SOURCES GRAPH]</heading>
</para><para>This tag creates the network of a water resources system as a graph, with edges corresponding to connections between reservoirs, allocated reservoirs, and water reuses. <linebreak/>
 There are no parameters in this block; instead, each line represents a directed <emphasis>edge</emphasis> in the water source graph. Each entry must be the <computeroutput>name</computeroutput> of a declared water source.<linebreak/>
 If a connection exists between <computeroutput>source1</computeroutput> and <computeroutput>source2</computeroutput>, include a line in this block as such: <programlisting><codeline><highlight class="normal">source1,source2</highlight></codeline>
</programlisting> For example, this InputFileParser graph and its visual map are shown. <programlisting><codeline><highlight class="normal">source1,source2</highlight></codeline>
<codeline><highlight class="normal">source2,source3</highlight></codeline>
<codeline><highlight class="normal">source4,source5</highlight></codeline>
<codeline><highlight class="normal">source5,source3</highlight></codeline>
</programlisting> <image type="html" name="85165928-8e14e900-b234-11ea-9161-6c9b2e14a01c.png"></image>
</para><para><heading level="3">[UTILITIES GRAPH]</heading>
</para><para>This tag is similar to [WATER SOURCES GRAPH], except for utilites. An <emphasis>edge</emphasis> between water sources represents a potential water exchange between two utilites. The same format as [WATER SOURCES GRAPH] is followed.</para><para><heading level="3">[WS TO UTILITY MATRIX]</heading>
</para><para>WaterPaths represents the connections between utilities and water sources as <programlisting><codeline><highlight class="normal">utility<sp/>source1,source2,...</highlight></codeline>
</programlisting> where <computeroutput>utility</computeroutput> is a utillity name and the subsequent <computeroutput>sources</computeroutput> are water source names. Here, <computeroutput>utility</computeroutput> uses <computeroutput>source1</computeroutput>, <computeroutput>source2</computeroutput>, and all following sources to reach its demand. Each declared utility must have its own line in this block.</para><para><heading level="3">[TABLE STORAGE SHIFT]</heading>
</para><para>Here, we define a matrix for respective table shortage shifts for potential reservoir expansions.<linebreak/>
 Entries should be in the following form: <programlisting><codeline><highlight class="normal">Utility<sp/>Reservoir<sp/>shift</highlight></codeline>
</programlisting> where <computeroutput>shift</computeroutput> is the integer representing associated reservoir table shift.</para><para><heading level="3">[RESTRICTIONS POLICY]</heading>
</para><para><table rows="7" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>apply_to_utilities  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>Which utility (or utilities) this restriction policy is to be applied to   </para></entry></row>
<row>
<entry thead="no"><para>stage_multipliers  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Demand reductions (percentage of unrestricted demand) associated with each restriction stage.   </para></entry></row>
<row>
<entry thead="no"><para>stage_triggers  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Short term ROF restrictions triggers   </para></entry></row>
<row>
<entry thead="no"><para>typesMonthlyDemandFraction  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Types of water uses   </para></entry></row>
<row>
<entry thead="no"><para>typesMonthlyWaterPrice  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Types of water prices   </para></entry></row>
<row>
<entry thead="no"><para>priceMultipliers  </para></entry><entry thead="no"><para>filename  </para></entry><entry thead="no"><para>Multipliers on water price   </para></entry></row>
</table>
</para><para><heading level="3">[TRANSFERS POLICY]</heading>
</para><para><table rows="7" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>apply_to_utilities  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>The utility (or utilities) that are the buyers for this transfer   </para></entry></row>
<row>
<entry thead="no"><para>source_utility_id  </para></entry><entry thead="no"><para>Utility  </para></entry><entry thead="no"><para>Which utility is the source for this transfer policy   </para></entry></row>
<row>
<entry thead="no"><para>transfer_water_source_id  </para></entry><entry thead="no"><para>Source  </para></entry><entry thead="no"><para>Which source the transfers utilize   </para></entry></row>
<row>
<entry thead="no"><para>source_treatment_buffer  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>Buffer for source treatment   </para></entry></row>
<row>
<entry thead="no"><para>pipe_transfer_capacities  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Capacity of inter-connections between utilities.   </para></entry></row>
<row>
<entry thead="no"><para>buyers_transfer_triggers  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Short term ROF triggers for transfers   </para></entry></row>
</table>
</para><para><heading level="3">[INSURANCE POLICY]</heading>
</para><para><table rows="5" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>apply_to_utilities  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>The utility (or utilities) that are the buyers for this transfer   </para></entry></row>
<row>
<entry thead="no"><para>insurance_triggers  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Short term ROF triggers for this drought insurance policy   </para></entry></row>
<row>
<entry thead="no"><para>insurance_premium  </para></entry><entry thead="no"><para>double  </para></entry><entry thead="no"><para>The premium on this insurance policy   </para></entry></row>
<row>
<entry thead="no"><para>fixed_payouts  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Amount of fixed payouts from insurance   </para></entry></row>
</table>
</para><para><heading level="3">[FIXED FLOW RESERVOIR CONTROL RULE]</heading>
</para><para><table rows="5" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>water_source_id  </para></entry><entry thead="no"><para>Source  </para></entry><entry thead="no"><para>The source of this fixed flow control rule   </para></entry></row>
<row>
<entry thead="no"><para>release  </para></entry><entry thead="no"><para>int  </para></entry><entry thead="no"><para>Volume of water released.   </para></entry></row>
<row>
<entry thead="no"><para>aux_water_sources_id  </para></entry><entry thead="no"><para>Source,Source,...  </para></entry><entry thead="no"><para>Auxiliary sources for this control rule   </para></entry></row>
<row>
<entry thead="no"><para>aux_utilities_id  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>Auxiliary utilities for this control rule   </para></entry></row>
</table>
</para><para><heading level="3">[INFLOW-BASED RESERVOIR CONTROL RULE]</heading>
</para><para><table rows="6" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>water_source_id  </para></entry><entry thead="no"><para>Source  </para></entry><entry thead="no"><para>The source of this inflow-based control rule   </para></entry></row>
<row>
<entry thead="no"><para>inflows  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Vector of reservoir inflows that define releases   </para></entry></row>
<row>
<entry thead="no"><para>releases  </para></entry><entry thead="no"><para>double,double,...  </para></entry><entry thead="no"><para>Vector of released defined by inflows   </para></entry></row>
<row>
<entry thead="no"><para>aux_water_sources_id  </para></entry><entry thead="no"><para>Source,Source,...  </para></entry><entry thead="no"><para>Auxiliary sources for this control rule   </para></entry></row>
<row>
<entry thead="no"><para>aux_utilities_id  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>Auxiliary utilities for this control rule   </para></entry></row>
</table>
</para><para><heading level="3">[SEASONAL RESERVOIR CONTROL RULE]</heading>
</para><para><table rows="6" cols="3"><row>
<entry thead="yes"><para>Parameter  </para></entry><entry thead="yes"><para>Value Type  </para></entry><entry thead="yes"><para>Description   </para></entry></row>
<row>
<entry thead="no"><para>water_source_id  </para></entry><entry thead="no"><para>Source  </para></entry><entry thead="no"><para>The source of this fixed flow control rule   </para></entry></row>
<row>
<entry thead="no"><para>week_thresholds  </para></entry><entry thead="no"><para>int,int,int,int  </para></entry><entry thead="no"><para>Weeks that define each season   </para></entry></row>
<row>
<entry thead="no"><para>releases  </para></entry><entry thead="no"><para>double,double,double,double  </para></entry><entry thead="no"><para>Releases for each season   </para></entry></row>
<row>
<entry thead="no"><para>aux_water_sources_id  </para></entry><entry thead="no"><para>Source,Source,...  </para></entry><entry thead="no"><para>Auxiliary sources for this control rule   </para></entry></row>
<row>
<entry thead="no"><para>aux_utilities_id  </para></entry><entry thead="no"><para>Utility,Utility,...  </para></entry><entry thead="no"><para>Auxiliary utilities for this control rule   </para></entry></row>
</table>
</para><para><heading level="3">[DECISON VARIABLE BOUNDS]</heading>
</para><para>If this WaterPaths simulation is an optimization, this block tells the BorgMOEA which variables to optimize within the WaterPaths framework. Each line should follow this format: <programlisting><codeline><highlight class="normal">index<sp/>lowerbound,upperbound</highlight></codeline>
</programlisting> The <computeroutput>lowerbound</computeroutput> and <computeroutput>upperbound</computeroutput> numeric values indicate the lowest and highest values this decision variable can take. <linebreak/>
 The <computeroutput>index</computeroutput> value is an integer, and each value in <emphasis>0..n-1</emphasis>, where <emphasis>n</emphasis> is the number of decision varaibles, must be taken. <linebreak/>
</para><para>A decision variable&apos;s <computeroutput>index</computeroutput> describes its relative ordered position within the *.wp* file. To declare a specific decision variable instance in another block, use <computeroutput>%%%</computeroutput> for optimized <emphasis>values</emphasis> and <computeroutput>@</computeroutput> preceding an alias for optimized orderings. <linebreak/>
</para><para>For example, consider a simple optimization case with 4 decision variables.<linebreak/>
</para><para><orderedlist>
<listitem><para>Declare the decision varibles in a [DECISION VARIABLE BOUNDS] block. <programlisting><codeline><highlight class="normal">[DECISION<sp/>VARIABLE<sp/>BOUNDS]</highlight></codeline>
<codeline><highlight class="normal">0<sp/>0.001,0.75<sp/><sp/><sp/><sp/>#<sp/>utility1<sp/>transfer<sp/>ROF<sp/>trigger</highlight></codeline>
<codeline><highlight class="normal">1<sp/>0.0,1,0<sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>source1<sp/>construction<sp/>rank</highlight></codeline>
<codeline><highlight class="normal">2<sp/>0.0,1.0<sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>source2<sp/>construction<sp/>rank</highlight></codeline>
<codeline><highlight class="normal">3<sp/>0.0,1.0<sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>source3<sp/>construction<sp/>rank</highlight></codeline>
</programlisting></para></listitem><listitem><para>Declare decision variable <computeroutput>0</computeroutput> (utility1 transfer ROF trigger) within a [TRANSFERS POLICY] block with a <computeroutput>%%%</computeroutput> <programlisting><codeline><highlight class="normal">[TRANSFERS<sp/>POLICY]</highlight></codeline>
<codeline><highlight class="normal">apply_to_utilities<sp/>utility1</highlight></codeline>
<codeline><highlight class="normal">source_utility_id<sp/>RandomUtility</highlight></codeline>
<codeline><highlight class="normal">...</highlight></codeline>
<codeline><highlight class="normal">buyers_transfer_triggers<sp/>%%%</highlight></codeline>
</programlisting></para></listitem><listitem><para>Declare decison variables <computeroutput>1</computeroutput> <computeroutput>2</computeroutput> and <computeroutput>3</computeroutput> (construction ranks) within a [UTILITY] block with a series of <computeroutput>@</computeroutput> <programlisting><codeline><highlight class="normal">[UTILITY]</highlight></codeline>
<codeline><highlight class="normal">name<sp/>RandomUtlity</highlight></codeline>
<codeline><highlight class="normal">...</highlight></codeline>
<codeline><highlight class="normal">rof_infra_construction_order<sp/>@source1,@source2,@source3</highlight></codeline>
<codeline><highlight class="normal">...</highlight></codeline>
</programlisting></para></listitem></orderedlist>
</para><para>This input file configuration will optimize a short-term transfer ROF for <computeroutput>utility1</computeroutput> and a long-term infrastructure expansion ordering for each <computeroutput>source</computeroutput>. Ensure that the intended ordering of decision varaibles (as declared within the [DECISION VARIABLES BOUNDS] block) corresponds to the order of appearence in the remainder of the input file. <linebreak/>
</para><para>For a more advanced optimization problem formulation, refer to <computeroutput>Tests/test_input_file_borg.wp</computeroutput>.</para><para><heading level="3">[OBJECTIVES EPSILONS]</heading>
</para><para>This tag declares the epsilon values for the five objectives:<orderedlist>
<listitem><para>Reliability</para></listitem><listitem><para>Restriction Frequency</para></listitem><listitem><para>Infrastructure NPV</para></listitem><listitem><para>Financial Cost</para></listitem><listitem><para>Worse First Percentile Cost</para></listitem></orderedlist>
</para><para>This block has one line, in the form: <programlisting><codeline><highlight class="normal">ep1,ep2,ep3,ep4,ep5</highlight></codeline>
</programlisting> where each epsilon corresponds to the respective numbered objective.<linebreak/>
</para><para>To use the recommended epsilon values, include this block: <programlisting><codeline><highlight class="normal">[OBJECTIVES<sp/>EPSILONS]</highlight></codeline>
<codeline><highlight class="normal">0.001,0.02,10.0,0.025,0.01</highlight></codeline>
</programlisting> </para>    </detaileddescription>
  </compounddef>
</doxygen>
